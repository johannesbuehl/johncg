<!DOCTYPE html>
<meta charset="UTF-8">
<html>
	<head>
		<title>
			johnCG - template
		</title>
		<style>
			body {
				margin: 0;

				overflow: hidden;

				background-color: black;
			}

			#_main {
				opacity: 0;

				width: 100vw;
				height: 100vh;

				display: flex;
				justify-content: center;
				align-items: center;
			}

			#container {
				width: 100%;
				height: 100%;

				display: flex;
				flex-direction: column;

				justify-content: center;
			}

			.slide {
				width: auto;
				height: auto;

				background-color: white;

				margin: 100px;

				/* width: 20vw; */
				white-space: nowrap;

				border: 1px solid red;
			}

			.text_line {
				font-family: "Calibri";
				font-size: inherit;

				text-align: center;
			}

			#storage {
				opacity: 0;

				width: fit-content;
			}
		</style>
	</head>
	<body id="body">
		<div id="_main">
			<div id="container">

			</div>
		</div>
		<div id="storage"></div>
	</body>
	<script>
		let o_data = {};

		let i_active_slide = 0;
		let i_slide_count = 0;

		// casparcg-function: transmits data
		function update(s_data) {
			// parse the transferred data into json
			o_data = JSON.parse(s_data);

			// get the div for the display and storage
			const c_div_text = document.getElementById("text");
			const c_div_storage = document.getElementById("storage");

			// clear the storage-container
			c_div_storage.innerHTML = "";

			// counter for the individual slides
			let i_slide = 0;

			// create the slides and store them in the container
			for (const c_a_s_slide of o_data["slides"]) {
				// parent-div of slide
				const c_div_slide = document.createElement("div");
				c_div_slide.classList.add("slide");
				c_div_slide.id = `slide_${i_slide}`;

				// add the individual text-lines
				for (const c_s_line of c_a_s_slide) {
					const c_div_line = document.createElement("div");
					c_div_line.classList.add("text_line");
					c_div_line.innerText = c_s_line;

					c_div_slide.append(c_div_line);
				}

				c_div_storage.append(c_div_slide);
				i_slide++;
			}

			// store the amount of slides
			i_slide_count = i_slide;

			// display the first slide
			jump(i_active_slide);
			// resize all the slides (has to be done after displayin the first slide)
			resize_slides();
		}

		// casparcg-function: displays the template
		function play() {
			document.getElementById("_main").style.opacity = 1;
		}

		// casparcg-function: advances to the next step
		function next() {
			jump(i_active_slide + 1);
		}

		// custom-function (through invoke): advance to the previous step
		function prev() {
			jump(i_active_slide - 1);
		}

		// custom-function (through invoke): jump to an arbitrary slide
		function jump(i_counter_raw) {
			const i_counter = i_clamp_slide_counter(i_counter_raw)

			// get the container to display the load the slide into
			const c_div__main = document.getElementById("container");

			// clear the content of the container
			c_div__main.innerHTML = "";

			// clone the slide and change its id, so the id stays unique
			const c_div_slide = document.getElementById(`slide_${i_counter}`).cloneNode(true);
			c_div_slide.id = "slide_active";

			c_div__main.appendChild(c_div_slide);

			i_active_slide = i_counter;
		}

		// casparcg-function: hide the template
		function stop() {
			document.getElementById("_main").style.opacity = 0;
		}

		// clamp the counter to valid values
		function i_clamp_slide_counter(i_counter_raw) {
			return Math.max(0, Math.min(i_slide_count - 1, i_counter_raw));
		}

		// change the font-size so the slide with the highest width uses all of the available space
		function resize_slides() {
			// get the highest width
			const c_i_max_width = i_get_max_width();

			// get the width of the container
			const c_i_current_container_width = document.getElementById("slide_active").clientWidth;

			// change the font size by the size difference ratio
			document.getElementById("container").style.fontSize = `${c_i_current_container_width / c_i_max_width}em`;
		}

		// get the width of the widest slide
		function i_get_max_width() {
			let i_max_width = 0;

			// get the width of the individual slides and store the biggest one 
			for (let ii = 0; ii < i_slide_count; ii++) {
				let i_current_width = document.getElementById(`slide_${ii}`).clientWidth;

				i_max_width = Math.max(i_current_width, i_max_width);
			}

			return i_max_width;
		}
	</script>
</html>